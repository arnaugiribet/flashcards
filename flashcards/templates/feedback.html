{% extends "base.html" %}

{% block title %}Feedback - doctude{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-[#f5f7f4] shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6">Share Your Feedback</h2>
        
        <form id="feedbackForm" method="POST" class="space-y-6">
            {% csrf_token %}
            
            <div class="space-y-2">
                <label for="name" class="block text-sm font-medium text-gray-700">
                    Name <span class="text-red-500">*</span>
                </label>
                <input type="text" 
                       name="name" 
                       id="name" 
                       required
                       class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#9daca2] focus:border-[#9daca2]"
                       {% if user.is_authenticated %}value="{{ user.get_username }}"{% endif %}>
            </div>

            <div class="space-y-2">
                <label for="email" class="block text-sm font-medium text-gray-700">
                    Email <span class="text-red-500">*</span>
                </label>
                <input type="email" 
                       name="email" 
                       id="email" 
                       required
                       class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#9daca2] focus:border-[#9daca2]"
                       {% if user.is_authenticated %}value="{{ user.email }}"{% endif %}>
            </div>
            
            <!-- Hidden input for username if authenticated -->
            {% if user.is_authenticated %}
            <input type="hidden" name="username" value="{{ user.get_username }}">
            {% endif %}

            <div class="space-y-2">
                <label for="feedbackType" class="block text-sm font-medium text-gray-700">
                    Feedback Type
                </label>
                <select name="feedbackType" 
                        id="feedbackType"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#9daca2] focus:border-[#9daca2]">
                    <option value="suggestion">Suggestion</option>
                    <option value="bug">Bug Report</option>
                    <option value="feature">Feature Request</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="space-y-2">
                <label for="message" class="block text-sm font-medium text-gray-700">
                    Your Message <span class="text-red-500">*</span>
                </label>
                <textarea name="message" 
                          id="message" 
                          required
                          rows="5"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#9daca2] focus:border-[#9daca2]"></textarea>
            </div>
            
            <div class="flex items-center justify-end">
                <button type="submit" 
                    id="submitBtn" 
                    class="bg-[#9daca2] text-white px-4 py-2 rounded-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#9daca2]">
                Submit Feedback
            </button>
            </div>
        </form>
    </div>
    <!-- Success Notification (Moved Below the Form) -->
    <div id="successNotification" 
        class="hidden mt-6 bg-[#d4e8d4] border border-[#a3c6a3] text-[#4f6b4f] px-4 py-3 rounded relative transition-opacity duration-500 ease-out opacity-100"
        role="alert">
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span>Thank you for the feedback! We appreciate your input.</span>
        </div>
    </div>
</div>

<style>
    /* Disable button style */
    button:disabled {
        background-color: #d1d1d1; /* Greyer color */
        cursor: not-allowed; /* Change cursor to not-allowed */
    }
</style>

<script>
    document.getElementById('feedbackForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        fetch(window.location.href, {
            method: 'POST',
            body: new FormData(this),
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                let notification = document.getElementById('successNotification');
                notification.classList.remove('hidden');
                
                setTimeout(() => {
                    notification.classList.add('opacity-0');
                    setTimeout(() => {
                        notification.classList.add('hidden');
                        notification.classList.remove('opacity-0');
                    }, 500);
                }, 8000);
                
                this.reset();
            }
        })
        .finally(() => {
            // Re-enable the submit button and reset the button text
            document.getElementById("submitBtn").disabled = false;
            document.getElementById("submitBtn").innerText = "Submit Feedback";
        });
    });
</script>

<script>
    document.getElementById("feedbackForm").addEventListener("submit", function(event) {
        // Disable button on form submit
        document.getElementById("submitBtn").disabled = true;
        // Optionally, you can change the button text to show processing
        document.getElementById("submitBtn").innerText = "Processing...";
    });
</script>

{% endblock %}