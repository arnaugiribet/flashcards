{% extends 'base.html' %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-[calc(100vh-200px)]">
    <div class="w-full max-w-2xl">
        <div class="bg-[#f4f6f5] rounded-lg shadow-md p-8">
            <div class="text-center mb-6">
                <h2 class="text-[#9daca2] text-2xl font-bold mb-2">Study Mode</h2>
                <p class="text-gray-600">Cards remaining: <span id="cards-remaining">{{ total_due_cards }}</span></p>
            </div>

            <div id="flashcard-container" class="bg-white rounded-lg p-6 shadow-inner mb-6">
                <div id="question" class="text-xl text-gray-800 mb-4 min-h-[100px] flex items-center justify-center text-center">
                    {{ card.question }}
                </div>

                <div id="answer" class="text-lg text-gray-700 mb-4 min-h-[100px] flex items-center justify-center text-center hidden">
                    {{ card.answer }}
                </div>

                <div id="card-controls" class="flex flex-col space-y-4">
                    <button id="show-answer-btn" class="w-full bg-[#9daca2] text-white py-3 rounded-md hover:bg-opacity-90 transition-colors">
                        Show Answer
                    </button>

                    <div id="review-buttons" class="hidden grid grid-cols-2 gap-4">
                        <button class="review-btn bg-green-500 text-white py-3 rounded-md hover:bg-green-600 transition-colors" data-result="correct">
                            Correct
                        </button>
                        <button class="review-btn bg-red-500 text-white py-3 rounded-md hover:bg-red-600 transition-colors" data-result="incorrect">
                            Incorrect
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const showAnswerBtn = document.getElementById('show-answer-btn');
    const answerDiv = document.getElementById('answer');
    const reviewButtons = document.getElementById('review-buttons');
    const questionDiv = document.getElementById('question');
    const cardsRemainingSpan = document.getElementById('cards-remaining');
    
    showAnswerBtn.addEventListener('click', function() {
        answerDiv.classList.remove('hidden');
        showAnswerBtn.classList.add('hidden');
        reviewButtons.classList.remove('hidden');
    });
    
    // Review button event listeners
    document.querySelectorAll('.review-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const result = this.getAttribute('data-result');
            const cardId = '{{ card.id }}';
            
            fetch('{% url "review_card" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: `card_id=${cardId}&result=${result}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Update card content
                    questionDiv.textContent = data.question;
                    answerDiv.textContent = data.answer;
                    
                    // Update remaining cards count
                    const currentCount = parseInt(cardsRemainingSpan.textContent);
                    cardsRemainingSpan.textContent = currentCount - 1;
                    
                    // Reset UI
                    answerDiv.classList.add('hidden');
                    showAnswerBtn.classList.remove('hidden');
                    reviewButtons.classList.add('hidden');
                } else if (data.status === 'completed') {
                    // All cards reviewed
                    document.getElementById('flashcard-container').innerHTML = `
                        <div class="text-center">
                            <h3 class="text-[#9daca2] text-2xl mb-4">Congratulations!</h3>
                            <p class="text-gray-600 mb-6">You've completed all your due cards for today.</p>
                            <div class="flex justify-center space-x-4">
                                <a href="{% url 'home' %}" class="bg-[#9daca2] text-white px-4 py-2 rounded-md hover:bg-opacity-90">
                                    Back to Home
                                </a>
                                <a href="{% url 'add_flashcards' %}" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300">
                                    Add More Cards
                                </a>
                            </div>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while processing your review.');
            });
        });
    });
});
</script>
{% endblock %}